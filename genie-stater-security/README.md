# Genie Starter Security

接口鉴权基础包，提供接口鉴权的基本功能，通过调用鉴权服务（UAA）得到访问用户的权限信息，然后基于权限对调用接口进行控制。

## 基本说明
对于网关层的接口安全机制。


## Sign 签名规则
将请求参数按照一定规则排序组合后 MD5 算法获取到 sign 签名值， 然后将该sign 作为额外的请求参数。

### token 辅助加密串
token 是在申请接入 Zuul 时， 由 PaaS team 创建的与apiKey对应的字符串，用于签名组装和加密。

### Query String/Form data 类型请求

#### 组装
- 所有参数组成形如`key=value`键值对形式的字符串。
（如果参数的值为空，或者为空字符串，不参与签名）

- 将所有的键值对字符串添加到一个 list 中。
> 注意： 参数名称同样的多个参数，仅第一个参数参与组装。

- 将该应用的 token 值追加到 list 中, 例如： token=XXXXXX。
> 注意： token 仅用于组装加密， 不在实际请求中传输。

- 对 list 进行排序后，拼接字符串， 得到加密前的字符串。

#### 加密

5.2.3请求
将加密后获得的密文作为额外参数（参数名 sign） 加入请求参数列表。 参阅【4.3
接口公共说明


### Json body 类型请求
#### 组装
- 所有参数（包括 query string 内的参数） 组成形如”key=value”键值对形
式的字符串。（如果参数的值为空，或者为空字符串，不参与签名）
其中 Json body 作为一个 key-value 传入， Key 名称即”body”， value 值则
需要对 request body 的内容按照规则序列化，序列化的规则详见【5.3.3
Json body 序列化规则】
- 将所有的键值对字符串添加到一个 list 中。
- 将该应用的 token 值追加到 list 中, 例如： token=XXXXXX。
> 注意： token 仅用于组装加密， 不在实际请求中传输。

- 对 list 进行排序后，拼接字符串， 得到加密前的字符串。
#### 加密

#### Json body 序列化规则
➢ 基本规则：将同级 key 名称按照字典排序（每一个参数名按照 a-z 的顺
序排序），若遇到相同的首字母，则看第二个字母，以此类推。
➢ 排序完成后，再把 list 中所有参数按照“key=value”的模式用“&”字
符拼接成字符串。
➢ 若参数值为对象类型（object/array） ，则递归执行上述步骤， 外层使
用{}或[]包裹
